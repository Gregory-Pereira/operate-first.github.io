{"componentChunkName":"component---src-templates-markdown-remark-js","path":"/hitchhikers-guide/apps/docs/content/ocs/runbook.md","result":{"data":{"site":{"siteMetadata":{"title":"Operate First"}},"markdownRemark":{"id":"e7038c82-e95d-50e3-ad29-265c2f866327","html":"<h1 id=\"openshift-container-storage-ocs-runbook\" style=\"position:relative;\"><a href=\"#openshift-container-storage-ocs-runbook\" aria-label=\"openshift container storage ocs runbook permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>OpenShift Container Storage (OCS) Runbook</h1>\n<h2 id=\"prerequisites\" style=\"position:relative;\"><a href=\"#prerequisites\" aria-label=\"prerequisites permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Prerequisites</h2>\n<p>You must be a cluster admin on the target OpenShift cluster.</p>\n<h2 id=\"identify-the-problem\" style=\"position:relative;\"><a href=\"#identify-the-problem\" aria-label=\"identify the problem permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Identify the problem</h2>\n<ul class=\"pf-c-list\">\n<li>Are existing PVs available?</li>\n<li>If you create a new <code class=\"language-text\">PersistentVolumeClaim</code>, does it bind immediately to a PV?</li>\n<li>\n<p>Are you able to access existing object buckets?</p>\n<ul class=\"pf-c-list\">\n<li>From inside the cluster?</li>\n<li>From outside the cluster?</li>\n</ul>\n</li>\n<li>If you create a new <code class=\"language-text\">ObjectBucketClaim</code>, does it bind immediately to\na new bucket?</li>\n</ul>\n<p>If <em>some</em> of the above steps work, there is (probably) a software\nproblem on the cluster. Continue with “Troubleshooting software\nproblems”.</p>\n<p>If <em>none</em> of the above steps work, it may be a connectivity problem\nwith the Ceph service; continue with “Troubleshooting Ceph\nconnectivity”.</p>\n<h2 id=\"troubleshooting-software-problems\" style=\"position:relative;\"><a href=\"#troubleshooting-software-problems\" aria-label=\"troubleshooting software problems permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Troubleshooting software problems</h2>\n<p>Generally, troubleshooting problems with the storage subsystem is\ngoing to be very much like troubleshooting issues with any other\napplication running on OpenShift:</p>\n<ul class=\"pf-c-list\">\n<li>Look for unhealthy pods (<code class=\"language-text\">oc get pod | grep -Evi\n&#39;running|completed&#39;</code>).</li>\n<li>Inspect the logs of unhealthy pods (<code class=\"language-text\">oc logs ...</code>).</li>\n<li>Inspect events for any errors (<code class=\"language-text\">oc get events</code>).</li>\n</ul>\n<h3 id=\"noobaa-object-storage\" style=\"position:relative;\"><a href=\"#noobaa-object-storage\" aria-label=\"noobaa object storage permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Noobaa object storage</h3>\n<p>To check the status of the Noobaa object storage service, install the\nNoobaa CLI from the <a href=\"https://github.com/noobaa/noobaa-operator/releases\">releases\npage</a> and then\nrun:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">noobaa -n openshift-storage status</code></pre></div>\n<p>This will emit a variety of validation messages on <em>stderr</em> and some\nstatus information on <em>stdout</em>.  The validation messages look\nsomething like:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">time=&quot;2021-11-23T17:07:41-05:00&quot; level=info msg=&quot;CRD Status:&quot;\ntime=&quot;2021-11-23T17:07:41-05:00&quot; level=info msg=&quot;✅ Exists: CustomResourceDefinition \\&quot;noobaas.noobaa.io\\&quot;\\n&quot;\n[...]\ntime=&quot;2021-11-23T17:07:41-05:00&quot; level=info msg=&quot;Operator Status:&quot;\ntime=&quot;2021-11-23T17:07:41-05:00&quot; level=info msg=&quot;✅ Exists: Namespace \\&quot;openshift-storage\\&quot;\\n&quot;\ntime=&quot;2021-11-23T17:07:41-05:00&quot; level=info msg=&quot;✅ Exists: ServiceAccount \\&quot;noobaa\\&quot;\\n&quot;\ntime=&quot;2021-11-23T17:07:41-05:00&quot; level=info msg=&quot;✅ Exists: ServiceAccount \\&quot;noobaa-endpoint\\&quot;\\n&quot;\n[...]\ntime=&quot;2021-11-23T17:07:41-05:00&quot; level=info msg=&quot;System Wait Ready:&quot;\ntime=&quot;2021-11-23T17:07:41-05:00&quot; level=info msg=&quot;✅ System Phase is \\&quot;Ready\\&quot;.\\n&quot;\ntime=&quot;2021-11-23T17:07:41-05:00&quot; level=info\ntime=&quot;2021-11-23T17:07:41-05:00&quot; level=info\ntime=&quot;2021-11-23T17:07:41-05:00&quot; level=info msg=&quot;System Status:&quot;\ntime=&quot;2021-11-23T17:07:41-05:00&quot; level=info msg=&quot;✅ Exists: NooBaa \\&quot;noobaa\\&quot;\\n&quot;\ntime=&quot;2021-11-23T17:07:41-05:00&quot; level=info msg=&quot;✅ Exists: StatefulSet \\&quot;noobaa-core\\&quot;\\n&quot;\n[...]\ntime=&quot;2021-11-23T17:07:42-05:00&quot; level=info msg=&quot;✅ System Phase is \\&quot;Ready\\&quot;\\n&quot;\ntime=&quot;2021-11-23T17:07:42-05:00&quot; level=info msg=&quot;✅ Exists:  \\&quot;noobaa-admin\\&quot;\\n&quot;</code></pre></div>\n<p>The status information includes various configuration details,\nincluding the external URL for the Noobaa management interface. You\nshould be able to log into that UI using your OpenShift credentials.</p>\n<h2 id=\"troubleshooting-ceph-connectivity\" style=\"position:relative;\"><a href=\"#troubleshooting-ceph-connectivity\" aria-label=\"troubleshooting ceph connectivity permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Troubleshooting Ceph connectivity</h2>\n<p>You can log into the <code class=\"language-text\">rook-ceph-tools</code> container to run Ceph commands\nto diagnose Ceph cluster health and connectivity problems. To log into\nthe pod:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">oc -n openshift-storage rsh deploy/rook-ceph-tools</code></pre></div>\n<p>If this deployment isn’t available, you can enable it by <a href=\"https://access.redhat.com/articles/4628891\">editing the\n<code class=\"language-text\">OCSInitialization</code>\nobject</a> (accessing that\nlink requires a Red Hat account).</p>\n<h3 id=\"configure-credentials\" style=\"position:relative;\"><a href=\"#configure-credentials\" aria-label=\"configure credentials permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Configure credentials</h3>\n<p>You will\nfirst need to make sure that appropriate credentials exist in\n<code class=\"language-text\">/etc/ceph</code>. Look at <code class=\"language-text\">/etc/ceph/keyring</code>; if it only contains…</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">[client.admin]\nkey = admin-secret</code></pre></div>\n<p>…then you will need to add credentials for the user we use to\nauthenticate to the ceph cluster.  You can obtain the appropriate\ncredentials by running:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">oc -n openshift-storage get secret rook-ceph-external-cluster-details -o json |\n  jq -r &#39;.data.external_cluster_details|@base64d&#39; |\n  jq &#39;.[]|select(.name == &quot;rook-csi-rbd-provisioner&quot;)|.data&#39;</code></pre></div>\n<p>This will return a JSON block that looks like:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">{\n  &quot;userID&quot;: &quot;...&quot;,\n  &quot;userKey&quot;: &quot;...&quot;\n}</code></pre></div>\n<p>Replace the contents of <code class=\"language-text\">/etc/ceph/keyring</code> with:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">[client.&lt;value from userID&gt;]\nkey = &lt;value from userKey&gt;</code></pre></div>\n<h3 id=\"check-ceph-status\" style=\"position:relative;\"><a href=\"#check-ceph-status\" aria-label=\"check ceph status permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Check ceph status</h3>\n<p>Run the <code class=\"language-text\">ceph health</code> command:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ ceph --id provisioner-moc-rbd-1 health\nHEALTH_WARN 5 clients failing to respond to cache pressure; 12 nearfull osd(s); 1 pool(s) full; 23 pool(s) nearfull; 1 pgs not deep-scrubbed in time; 19 pgs not scrubbed in time</code></pre></div>\n<p>What we care about here is that we get a valid response back from the\nCeph cluster (that is, the command returns information about the\nhealth of the ceph cluster, rather than some sort of communication or\nauthentication error, etc). In general we don’t care about the actual\nstatus value, because it might be in <code class=\"language-text\">WARN</code> or <code class=\"language-text\">ERROR</code> states due to\nproblems that don’t actually impact our usage of the cluster.</p>\n<h3 id=\"check-rbd-access\" style=\"position:relative;\"><a href=\"#check-rbd-access\" aria-label=\"check rbd access permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Check RBD access</h3>\n<p>Ensure that you can list volumes in our RBD pool:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ rbd --id provisioner-moc-rbd-1 --pool moc_rbd_1 ls</code></pre></div>\n<p>This should return a list of CSI volumes, like:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">csi-vol-0b5f9497-40cb-11ec-ac60-0a580a8005aa\ncsi-vol-15aac588-3cdc-11ec-ac60-0a580a8005aa\ncsi-vol-16bd1d89-436a-11ec-ac60-0a580a8005aa\n...</code></pre></div>\n<h3 id=\"check-that-you-can-create-and-delete-rbd-volumes\" style=\"position:relative;\"><a href=\"#check-that-you-can-create-and-delete-rbd-volumes\" aria-label=\"check that you can create and delete rbd volumes permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Check that you can create and delete RBD volumes</h3>\n<p>Try creating an RBD volume:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">rbd --id provisioner-moc-rbd-1 --pool moc_rbd_1 create testvol --size 1G</code></pre></div>\n<p>And try to delete it:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">rbd --id provisioner-moc-rbd-1 --pool moc_rbd_1 rm testvol</code></pre></div>","fields":{"srcLink":"https://github.com/operate-first/apps/blob/master/docs/content/ocs/runbook.md"},"frontmatter":{"title":"","description":null,"extraClasses":null,"banner":null}}},"pageContext":{"id":"e7038c82-e95d-50e3-ad29-265c2f866327"}},"staticQueryHashes":["117426894","1764348645","3000541721","3606484676"]}