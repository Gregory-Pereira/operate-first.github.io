{"componentChunkName":"component---src-templates-markdown-remark-js","path":"/data-science/ds-workflows/docs/serving_monitoring/deploy-models-using-seldon.md","result":{"data":{"site":{"siteMetadata":{"title":"Operate First"}},"markdownRemark":{"id":"b51087f9-e691-53ab-acb4-8401601be939","html":"<h1 id=\"deploy-models-on-openshift-using-seldon-server\" style=\"position:relative;\"><a href=\"#deploy-models-on-openshift-using-seldon-server\" aria-label=\"deploy models on openshift using seldon server permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Deploy models on OpenShift using Seldon Server</h1>\n<p>Have a model trained and ready to share with the world? In this guide, we go over how to deploy models as a microservice using one of Seldon Core’s pre-packaged <a href=\"https://docs.seldon.io/projects/seldon-core/en/v1.1.0/servers/overview.html\">model servers</a>.</p>\n<h2 id=\"pre-requisites\" style=\"position:relative;\"><a href=\"#pre-requisites\" aria-label=\"pre requisites permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Pre-requisites</h2>\n<ul class=\"pf-c-list\">\n<li>An ML model trained using one of these supported ML <a href=\"https://docs.seldon.io/projects/seldon-core/en/latest/nav/config/servers.html\">libraries</a> or a custom model (guide forthcoming) .</li>\n<li>OpenShift namespace with <a href=\"https://docs.seldon.io/projects/seldon-core/en/latest/workflow/install.html#openshift\">seldon operator installed</a> and administrator privileges available. (If you are using the <a href=\"https://console-openshift-console.apps.zero.massopen.cloud/\">Operate First cluster</a>, you can use the namespace <code class=\"language-text\">ds-ml-workflows-ws</code> which already has Seldon deployed).</li>\n</ul>\n<h2 id=\"steps-to-deploy\" style=\"position:relative;\"><a href=\"#steps-to-deploy\" aria-label=\"steps to deploy permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Steps to deploy</h2>\n<ol class=\"pf-c-list\">\n<li>Save the model as a .joblib file and name it <code class=\"language-text\">model.joblib</code>. Push the model to S3 in its own directory. For example a path like <code class=\"language-text\">s3://&lt;bucket_name&gt;/&lt;project_name&gt;/&lt;model_name&gt;/model.joblib</code>.</li>\n<li>\n<p>On the OpenShift console:</p>\n<ul class=\"pf-c-list\">\n<li>\n<p>Ensure the Seldon-Core operator is installed in the namespace where you are deploying.</p>\n<ul class=\"pf-c-list\">\n<li>If you are using the <a href=\"https://console-openshift-console.apps.zero.massopen.cloud/\">Operate First cluster</a>, you can use the namespace <code class=\"language-text\">ds-ml-workflows-ws</code> which has Seldon deployed.</li>\n<li>To get access to this namespace, <a href=\"https://github.com/operate-first/support/issues/new/choose\">open an issue</a> on the operate-first/support repository.</li>\n</ul>\n</li>\n<li>In the namespace, add create a secret with the AWS credentials for access to the bucket. To create a Secret, go to <code class=\"language-text\">Workloads</code>, <code class=\"language-text\">Secrets</code>, click on <code class=\"language-text\">Create</code> and select <code class=\"language-text\">From YAML</code> in the dropdown menu. </li>\n</ul>\n<p><img src=\"/public/assets/deploy-models-using-seldon/create-secret.png\" alt=\"create secret\"></p>\n<p>Here is an example of the format of the secret:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">apiVersion: v1\nkind: Secret\nmetadata:\nname: seldon-init-container-secret\ntype: Opaque\ndata:\nAWS_ACCESS_KEY_ID: XXXX\nAWS_SECRET_ACCESS_KEY: XXXX\nAWS_ENDPOINT_URL: XXXX\nUSE_SSL: XXXX</code></pre></div>\n<p><em>Find documentation on how to configure different object storage providers <a href=\"https://docs.seldon.io/projects/seldon-core/en/latest/servers/kfserving-storage-initializer.html\">here</a></em>.</p>\n<ul class=\"pf-c-list\">\n<li>\n<p>First select an “Administrator” profile, then under Operators and Installed Operators you can add new Seldon Deployment in Seldon Core operator by clicking on <code class=\"language-text\">Create Instance</code>.</p>\n<ul class=\"pf-c-list\">\n<li>Select <code class=\"language-text\">YAML view</code> and enter your model deployment configuration. <a href=\"https://github.com/aicoe-aiops/ocp-ci-analysis/blob/master/notebooks/time-to-merge-prediction/seldon-deployment-config.yaml\">Here</a> is an example deployment configuration which uses the Sklearn Server.</li>\n<li>Find more information on the formats of the deployment configs for other <a href=\"https://docs.seldon.io/projects/seldon-core/en/latest/nav/config/servers.html\">model servers here</a>.</li>\n</ul>\n</li>\n</ul>\n<p><img src=\"/public/assets/deploy-models-using-seldon/create-deployment.png\" alt=\"create deployment\"></p>\n<ul class=\"pf-c-list\">\n<li>If you are using the SKLearn Seldon server, the <code class=\"language-text\">modeluri</code> refers to the model’s prefix in the Ceph bucket. In your Seldon Deployment, change model URI to be for your model. Sample model URI from S3: <code class=\"language-text\">s3://&lt;bucket_name&gt;/&lt;project_name&gt;/&lt;model_name&gt;/model.joblib</code></li>\n<li>In your Seldon Deployment, add a reference to the secret with the AWS credentials for access to the bucket like <code class=\"language-text\">envSecretRefName: seldon-init-container-secret</code>, where seldon-init-container-secret is the secret name.</li>\n<li>To test the deployed model endpoint, create a route to the deployed model by selecting the deployed service. To create a route, from the OpenShift console, go to <code class=\"language-text\">Networking</code>, then go to <code class=\"language-text\">Routes</code> and click on “Create Route”. Give the route a desired name, and select the service that we deployed earlier, select a “Target Port” and click on Create.</li>\n</ul>\n<p><img src=\"/public/assets/deploy-models-using-seldon/create-route.png\" alt=\"create route\"></p>\n<p>Once the route has been created, you can send a curl request to interact with the route like:</p>\n<p><code class=\"language-text\">curl -X POST -H &#39;Content-Type: application/json&#39; -d &#39;{&quot;data&quot;: { &quot;ndarray&quot;: [[1,2,3,4]]}}&#39; http://localhost:5000/api/v1.0/predictions</code></p>\n<p>You can also create a notebook such as <a href=\"https://github.com/aicoe-aiops/ocp-ci-analysis/blob/master/notebooks/time-to-merge-prediction/model_inference.ipynb\">this</a> to interact with the model and ensure that the service is running as intended.</p>\n</li>\n</ol>","fields":{"srcLink":"https://github.com/aicoe-aiops/data-science-workflows/blob/master/docs/serving_monitoring/deploy-models-using-seldon.md"},"frontmatter":{"title":"","description":null,"extraClasses":null,"banner":null}}},"pageContext":{"id":"b51087f9-e691-53ab-acb4-8401601be939"}},"staticQueryHashes":["1764348645","2823140819","3000541721","3606484676"]}