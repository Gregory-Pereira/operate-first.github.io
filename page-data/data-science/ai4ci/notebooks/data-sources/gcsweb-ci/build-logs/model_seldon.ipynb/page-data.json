{"componentChunkName":"component---src-templates-jupyter-notebook-js","path":"/data-science/ai4ci/notebooks/data-sources/gcsweb-ci/build-logs/model_seldon.ipynb","result":{"data":{"site":{"siteMetadata":{"title":"Operate First"}},"jupyterNotebook":{"id":"e3365e98-c16b-598f-a395-2d71546d74f4 >>> JupyterNotebook","html":"<div class=\"notebook-render\"><div class=\"sc-ifAKCX zMCZx\"><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><h1>Seldon deployment for build log clustering</h1>\n<p>In this notebook, we deploy a seldon service for clustering build logs. First, we take the experiments in <a href=\"build_log_term_freq.ipynb\">build log clustering notebook</a> and train a Sklearn pipeline with all the components. Then, we save the model on s3 storage and deploy a seldon service that uses the saved model. Finally, we test the service for inference on an example request. </p></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[1]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#0000ff\">import</span> os\n<span class=\"token\" style=\"color:#0000ff\">import</span> pandas <span class=\"token\" style=\"color:#0000ff\">as</span> pd\n<span class=\"token\" style=\"color:#0000ff\">import</span> random\n<span class=\"token\" style=\"color:#0000ff\">import</span> requests\n<span class=\"token\" style=\"color:#0000ff\">import</span> seaborn <span class=\"token\" style=\"color:#0000ff\">as</span> sns\n<span class=\"token\" style=\"color:#0000ff\">from</span> matplotlib <span class=\"token\" style=\"color:#0000ff\">import</span> cm\n<span class=\"token\" style=\"color:#0000ff\">from</span> sklearn<span class=\"token\" style=\"color:#393A34\">.</span>cluster <span class=\"token\" style=\"color:#0000ff\">import</span> KMeans\n<span class=\"token\" style=\"color:#0000ff\">from</span> sklearn<span class=\"token\" style=\"color:#393A34\">.</span>feature_extraction<span class=\"token\" style=\"color:#393A34\">.</span>text <span class=\"token\" style=\"color:#0000ff\">import</span> TfidfVectorizer\n<span class=\"token\" style=\"color:#0000ff\">from</span> sklearn<span class=\"token\" style=\"color:#393A34\">.</span>pipeline <span class=\"token\" style=\"color:#0000ff\">import</span> Pipeline\n<span class=\"token\" style=\"color:#0000ff\">import</span> joblib\n<span class=\"token\" style=\"color:#0000ff\">import</span> boto3\n<span class=\"token\" style=\"color:#0000ff\">import</span> json\n<span class=\"token\" style=\"color:#0000ff\">from</span> dotenv <span class=\"token\" style=\"color:#0000ff\">import</span> load_dotenv<span class=\"token\" style=\"color:#393A34\">,</span> find_dotenv\n\nload_dotenv<span class=\"token\" style=\"color:#393A34\">(</span>find_dotenv<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># Some settings for the notebook</span>\npd<span class=\"token\" style=\"color:#393A34\">.</span>options<span class=\"token\" style=\"color:#393A34\">.</span>display<span class=\"token\" style=\"color:#393A34\">.</span>float_format <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#A31515\">&quot;{:.2f}&quot;</span><span class=\"token\" style=\"color:#393A34\">.</span><span class=\"token builtin\">format</span>\nrandom<span class=\"token\" style=\"color:#393A34\">.</span>seed<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#36acaa\">1</span><span class=\"token\" style=\"color:#393A34\">)</span>\nsns<span class=\"token\" style=\"color:#393A34\">.</span><span class=\"token builtin\">set</span><span class=\"token\" style=\"color:#393A34\">(</span>rc<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#393A34\">{</span><span class=\"token\" style=\"color:#A31515\">&quot;figure.figsize&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#36acaa\">15</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#36acaa\">5</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">}</span><span class=\"token\" style=\"color:#393A34\">)</span>\ncolormap <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">(</span>\n    cm<span class=\"token\" style=\"color:#393A34\">.</span>brg\n<span class=\"token\" style=\"color:#393A34\">)</span>  <span class=\"token\" style=\"color:#008000;font-style:italic\"># see https://matplotlib.org/stable/tutorials/colors/colormaps.html for alternatives</span></code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><h1>Load Dataset</h1></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[2]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># Note: periodic jobs only (see FIXME in class Builds)</span>\njob_name <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#A31515\">&quot;periodic-ci-openshift-release-master-ci-4.8-e2e-gcp&quot;</span>\n\nlogs_path <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#A31515\">&quot;../../../../data/raw/gcs/build-logs/&quot;</span>  <span class=\"token\" style=\"color:#008000;font-style:italic\"># local cache of build log files</span>\nmetadata_path <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#A31515\">&quot;../../../../data/raw/gcs/build-metadata/&quot;</span>  <span class=\"token\" style=\"color:#008000;font-style:italic\"># path to saved metadata</span>\nmetadata_file_name <span class=\"token\" style=\"color:#393A34\">=</span> os<span class=\"token\" style=\"color:#393A34\">.</span>path<span class=\"token\" style=\"color:#393A34\">.</span>join<span class=\"token\" style=\"color:#393A34\">(</span>metadata_path<span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token string-interpolation\"><span class=\"token\" style=\"color:#A31515\">f&quot;</span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span>job_name<span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\">_build-logs.csv&quot;</span></span><span class=\"token\" style=\"color:#393A34\">)</span>\n\n\n<span class=\"token\" style=\"color:#0000ff\">def</span> <span class=\"token\" style=\"color:#393A34\">log_path_for</span><span class=\"token\" style=\"color:#393A34\">(</span>build_id<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">:</span>\n    <span class=\"token\" style=\"color:#0000ff\">return</span> os<span class=\"token\" style=\"color:#393A34\">.</span>path<span class=\"token\" style=\"color:#393A34\">.</span>join<span class=\"token\" style=\"color:#393A34\">(</span>logs_path<span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token string-interpolation\"><span class=\"token\" style=\"color:#A31515\">f&quot;</span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span>build_id<span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\">.txt&quot;</span></span><span class=\"token\" style=\"color:#393A34\">)</span>\n\n\n<span class=\"token\" style=\"color:#0000ff\">def</span> <span class=\"token\" style=\"color:#393A34\">prow_url_for</span><span class=\"token\" style=\"color:#393A34\">(</span>build_id<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">:</span>\n    project <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#A31515\">&quot;origin-ci-test&quot;</span>\n    <span class=\"token\" style=\"color:#008000;font-style:italic\"># FIXME: this prefix is only for periodic jobs</span>\n    job_prefix <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token string-interpolation\"><span class=\"token\" style=\"color:#A31515\">f&quot;logs/</span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span>job_name<span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\">/&quot;</span></span>\n    <span class=\"token\" style=\"color:#0000ff\">return</span> <span class=\"token string-interpolation\"><span class=\"token\" style=\"color:#A31515\">f&quot;https://prow.ci.openshift.org/view/gcs/</span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span>project<span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\">/</span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span>job_prefix<span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span>build_id<span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\">&quot;</span></span>\n\n\n<span class=\"token\" style=\"color:#0000ff\">def</span> <span class=\"token\" style=\"color:#393A34\">clean_df</span><span class=\"token\" style=\"color:#393A34\">(</span>df<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">:</span>\n    <span class=\"token triple-quoted-string\" style=\"color:#A31515\">&quot;&quot;&quot;Polishes the metadata DataFrame&quot;&quot;&quot;</span>\n    build_errors <span class=\"token\" style=\"color:#393A34\">=</span> df<span class=\"token\" style=\"color:#393A34\">[</span>df<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;result&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">==</span> <span class=\"token\" style=\"color:#A31515\">&quot;error&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span>index\n    df<span class=\"token\" style=\"color:#393A34\">.</span>drop<span class=\"token\" style=\"color:#393A34\">(</span>build_errors<span class=\"token\" style=\"color:#393A34\">,</span> inplace<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">)</span>  <span class=\"token\" style=\"color:#008000;font-style:italic\"># Remove builds that erroed (prow error)</span>\n    df<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;duration&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">=</span> df<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;end&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">-</span> df<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;start&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span>  <span class=\"token\" style=\"color:#008000;font-style:italic\"># From timestamps to job duration</span>\n    df<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;success&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">=</span> df<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;result&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">==</span> <span class=\"token\" style=\"color:#A31515\">&quot;SUCCESS&quot;</span>  <span class=\"token\" style=\"color:#008000;font-style:italic\"># A boolean version of the result</span>\n    <span class=\"token\" style=\"color:#0000ff\">return</span> df\n\n\n<span class=\"token\" style=\"color:#0000ff\">print</span><span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;Reading metadata from&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> metadata_file_name<span class=\"token\" style=\"color:#393A34\">)</span>\ndf <span class=\"token\" style=\"color:#393A34\">=</span> pd<span class=\"token\" style=\"color:#393A34\">.</span>read_csv<span class=\"token\" style=\"color:#393A34\">(</span>metadata_file_name<span class=\"token\" style=\"color:#393A34\">,</span> index_col<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">)</span>\ndf <span class=\"token\" style=\"color:#393A34\">=</span> clean_df<span class=\"token\" style=\"color:#393A34\">(</span>df<span class=\"token\" style=\"color:#393A34\">)</span>\ndf</code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><code class=\"nteract-display-area-stdout\"><span>Reading metadata from ../../../../data/raw/gcs/build-metadata/periodic-ci-openshift-release-master-ci-4.8-e2e-gcp_build-logs.csv\n</span></code><div><div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>result</th>\n      <th>size</th>\n      <th>start</th>\n      <th>end</th>\n      <th>duration</th>\n      <th>success</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>1368338379971760128</th>\n      <td>FAILURE</td>\n      <td>5846974</td>\n      <td>1615072270</td>\n      <td>1615076702</td>\n      <td>4432</td>\n      <td>False</td>\n    </tr>\n    <tr>\n      <th>1372646746210963456</th>\n      <td>SUCCESS</td>\n      <td>9785</td>\n      <td>1616099471</td>\n      <td>1616104582</td>\n      <td>5111</td>\n      <td>True</td>\n    </tr>\n    <tr>\n      <th>1375709011390763008</th>\n      <td>SUCCESS</td>\n      <td>9962</td>\n      <td>1616829565</td>\n      <td>1616834000</td>\n      <td>4435</td>\n      <td>True</td>\n    </tr>\n    <tr>\n      <th>1380281977160077312</th>\n      <td>SUCCESS</td>\n      <td>3841</td>\n      <td>1617919845</td>\n      <td>1617929494</td>\n      <td>9649</td>\n      <td>True</td>\n    </tr>\n    <tr>\n      <th>1385025333723402240</th>\n      <td>SUCCESS</td>\n      <td>3868</td>\n      <td>1619050750</td>\n      <td>1619056186</td>\n      <td>5436</td>\n      <td>True</td>\n    </tr>\n    <tr>\n      <th>...</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>1381826019446493184</th>\n      <td>SUCCESS</td>\n      <td>3837</td>\n      <td>1618287973</td>\n      <td>1618292751</td>\n      <td>4778</td>\n      <td>True</td>\n    </tr>\n    <tr>\n      <th>1371068681810874368</th>\n      <td>SUCCESS</td>\n      <td>9782</td>\n      <td>1615723223</td>\n      <td>1615728027</td>\n      <td>4804</td>\n      <td>True</td>\n    </tr>\n    <tr>\n      <th>1377999575511470080</th>\n      <td>SUCCESS</td>\n      <td>12329</td>\n      <td>1617375678</td>\n      <td>1617380533</td>\n      <td>4855</td>\n      <td>True</td>\n    </tr>\n    <tr>\n      <th>1369750447904002048</th>\n      <td>FAILURE</td>\n      <td>6467331</td>\n      <td>1615408933</td>\n      <td>1615413675</td>\n      <td>4742</td>\n      <td>False</td>\n    </tr>\n    <tr>\n      <th>1382368829539094528</th>\n      <td>SUCCESS</td>\n      <td>3840</td>\n      <td>1618417400</td>\n      <td>1618422303</td>\n      <td>4903</td>\n      <td>True</td>\n    </tr>\n  </tbody>\n</table>\n<p>837 rows × 6 columns</p>\n</div></div></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[3]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># Get a list of paths to the local copy of each build log</span>\nbuild_logs <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">]</span>\n<span class=\"token\" style=\"color:#0000ff\">for</span> build_id <span class=\"token\" style=\"color:#0000ff\">in</span> df<span class=\"token\" style=\"color:#393A34\">.</span>index<span class=\"token\" style=\"color:#393A34\">:</span>\n    <span class=\"token\" style=\"color:#0000ff\">with</span> <span class=\"token builtin\">open</span><span class=\"token\" style=\"color:#393A34\">(</span>log_path_for<span class=\"token\" style=\"color:#393A34\">(</span>build_id<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&quot;r&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span> <span class=\"token\" style=\"color:#0000ff\">as</span> f<span class=\"token\" style=\"color:#393A34\">:</span>\n        build_logs<span class=\"token\" style=\"color:#393A34\">.</span>append<span class=\"token\" style=\"color:#393A34\">(</span>f<span class=\"token\" style=\"color:#393A34\">.</span>read<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><h1>Train SKlearn Pipeline</h1></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[4]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\">token_pattern <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#A31515\">r&quot;\\b[a-z][a-z0-9_/\\.-]+\\b&quot;</span>\nvectorizer <span class=\"token\" style=\"color:#393A34\">=</span> TfidfVectorizer<span class=\"token\" style=\"color:#393A34\">(</span>\n    min_df<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">0.03</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    token_pattern<span class=\"token\" style=\"color:#393A34\">=</span>token_pattern<span class=\"token\" style=\"color:#393A34\">,</span>\n<span class=\"token\" style=\"color:#393A34\">)</span>\n\nk <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#36acaa\">3</span>\nkmeans <span class=\"token\" style=\"color:#393A34\">=</span> KMeans<span class=\"token\" style=\"color:#393A34\">(</span>n_clusters<span class=\"token\" style=\"color:#393A34\">=</span>k<span class=\"token\" style=\"color:#393A34\">,</span> random_state<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">123</span><span class=\"token\" style=\"color:#393A34\">)</span>\n\npipeline <span class=\"token\" style=\"color:#393A34\">=</span> Pipeline<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;tfidf&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> vectorizer<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;kmeans&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> kmeans<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[ ]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\">pipeline<span class=\"token\" style=\"color:#393A34\">.</span>fit<span class=\"token\" style=\"color:#393A34\">(</span>build_logs<span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><h1>Save Pipeline</h1></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[ ]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\">joblib<span class=\"token\" style=\"color:#393A34\">.</span>dump<span class=\"token\" style=\"color:#393A34\">(</span>pipeline<span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&quot;model.joblib&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[5]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># Sanity check to see if the saved model works locally</span>\npipeline_loaded <span class=\"token\" style=\"color:#393A34\">=</span> joblib<span class=\"token\" style=\"color:#393A34\">.</span>load<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;model.joblib&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span>\npipeline_loaded\npipeline_loaded<span class=\"token\" style=\"color:#393A34\">.</span>predict<span class=\"token\" style=\"color:#393A34\">(</span>build_logs<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#36acaa\">50</span><span class=\"token\" style=\"color:#393A34\">:</span><span class=\"token\" style=\"color:#36acaa\">75</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><pre><code><span>array([2, 2, 1, 0, 1, 2, 0, 0, 1, 2, 0, 1, 2, 2, 1, 0, 0, 0, 2, 2, 0, 1,\n       1, 1, 2], dtype=int32)</span></code></pre></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[6]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># Set credentials for your s3 storage</span>\ns3_endpoint_url <span class=\"token\" style=\"color:#393A34\">=</span> os<span class=\"token\" style=\"color:#393A34\">.</span>getenv<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;S3_ENDPOINT&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span>\naws_access_key_id <span class=\"token\" style=\"color:#393A34\">=</span> os<span class=\"token\" style=\"color:#393A34\">.</span>getenv<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;S3_ACCESS_KEY&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span>\naws_secret_access_key <span class=\"token\" style=\"color:#393A34\">=</span> os<span class=\"token\" style=\"color:#393A34\">.</span>getenv<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;S3_SECRET_KEY&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span>\ns3_bucket <span class=\"token\" style=\"color:#393A34\">=</span> os<span class=\"token\" style=\"color:#393A34\">.</span>getenv<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;S3_BUCKET&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[7]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\">s3_resource <span class=\"token\" style=\"color:#393A34\">=</span> boto3<span class=\"token\" style=\"color:#393A34\">.</span>resource<span class=\"token\" style=\"color:#393A34\">(</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;s3&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    endpoint_url<span class=\"token\" style=\"color:#393A34\">=</span>s3_endpoint_url<span class=\"token\" style=\"color:#393A34\">,</span>\n    aws_access_key_id<span class=\"token\" style=\"color:#393A34\">=</span>aws_access_key_id<span class=\"token\" style=\"color:#393A34\">,</span>\n    aws_secret_access_key<span class=\"token\" style=\"color:#393A34\">=</span>aws_secret_access_key<span class=\"token\" style=\"color:#393A34\">,</span>\n<span class=\"token\" style=\"color:#393A34\">)</span>\nbucket <span class=\"token\" style=\"color:#393A34\">=</span> s3_resource<span class=\"token\" style=\"color:#393A34\">.</span>Bucket<span class=\"token\" style=\"color:#393A34\">(</span>name<span class=\"token\" style=\"color:#393A34\">=</span>s3_bucket<span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[8]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># Upload your model</span>\nbucket<span class=\"token\" style=\"color:#393A34\">.</span>upload_file<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;model.joblib&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&quot;build-log-clustering/tfidf-kmeans/model.joblib&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span>\n\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># Check if your model exists on s3</span>\nobjects <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>\n    obj<span class=\"token\" style=\"color:#393A34\">.</span>key <span class=\"token\" style=\"color:#0000ff\">for</span> obj <span class=\"token\" style=\"color:#0000ff\">in</span> bucket<span class=\"token\" style=\"color:#393A34\">.</span>objects<span class=\"token\" style=\"color:#393A34\">.</span><span class=\"token builtin\">filter</span><span class=\"token\" style=\"color:#393A34\">(</span>Prefix<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#A31515\">&quot;&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span> <span class=\"token\" style=\"color:#0000ff\">if</span> <span class=\"token\" style=\"color:#A31515\">&quot;model.joblib&quot;</span> <span class=\"token\" style=\"color:#0000ff\">in</span> obj<span class=\"token\" style=\"color:#393A34\">.</span>key\n<span class=\"token\" style=\"color:#393A34\">]</span>\nobjects</code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><pre><code><span>[&#x27;build-log-clustering/tfidf-kmeans/model.joblib&#x27;,\n &#x27;github/ttm-model/model.joblib&#x27;,\n &#x27;github/ttm-model/pipeline/model.joblib&#x27;,\n &#x27;model.joblib&#x27;,\n &#x27;ocp-ci-analysis/models/build-log-classifier/model.joblib&#x27;]</span></code></pre></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><h1>Test seldon deployment service</h1>\n<p>We use the deployment <a href=\"seldon_deployment_config.yaml\">config</a> to deploy a seldon service.</p></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[9]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># Service url</span>\nbase_url <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#A31515\">&quot;http://build-log-clustering-opf-seldon.apps.zero.massopen.cloud/predict&quot;</span></code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[10]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># Test set (same as locally checked model)</span>\ntest_list <span class=\"token\" style=\"color:#393A34\">=</span> build_logs<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#36acaa\">50</span><span class=\"token\" style=\"color:#393A34\">:</span><span class=\"token\" style=\"color:#36acaa\">75</span><span class=\"token\" style=\"color:#393A34\">]</span></code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[11]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># convert the dataframe into a numpy array and then to a list (required by seldon)</span>\ndata <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">{</span><span class=\"token\" style=\"color:#A31515\">&quot;data&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#393A34\">{</span><span class=\"token\" style=\"color:#A31515\">&quot;ndarray&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> test_list<span class=\"token\" style=\"color:#393A34\">}</span><span class=\"token\" style=\"color:#393A34\">}</span>\n\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># create the query payload</span>\njson_data <span class=\"token\" style=\"color:#393A34\">=</span> json<span class=\"token\" style=\"color:#393A34\">.</span>dumps<span class=\"token\" style=\"color:#393A34\">(</span>data<span class=\"token\" style=\"color:#393A34\">)</span>\nheaders <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">{</span><span class=\"token\" style=\"color:#A31515\">&quot;content-Type&quot;</span><span class=\"token\" style=\"color:#393A34\">:</span> <span class=\"token\" style=\"color:#A31515\">&quot;application/json&quot;</span><span class=\"token\" style=\"color:#393A34\">}</span>\n\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># query our inference service</span>\nresponse <span class=\"token\" style=\"color:#393A34\">=</span> requests<span class=\"token\" style=\"color:#393A34\">.</span>post<span class=\"token\" style=\"color:#393A34\">(</span>base_url<span class=\"token\" style=\"color:#393A34\">,</span> data<span class=\"token\" style=\"color:#393A34\">=</span>json_data<span class=\"token\" style=\"color:#393A34\">,</span> headers<span class=\"token\" style=\"color:#393A34\">=</span>headers<span class=\"token\" style=\"color:#393A34\">)</span>\nresponse</code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><pre><code><span>&lt;Response [200]&gt;</span></code></pre></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[12]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\">response<span class=\"token\" style=\"color:#393A34\">.</span>json<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><pre><code><span>{&#x27;data&#x27;: {&#x27;names&#x27;: [],\n  &#x27;ndarray&#x27;: [2,\n   2,\n   1,\n   0,\n   1,\n   2,\n   0,\n   0,\n   1,\n   2,\n   0,\n   1,\n   2,\n   2,\n   1,\n   0,\n   0,\n   0,\n   2,\n   2,\n   0,\n   1,\n   1,\n   1,\n   2]},\n &#x27;meta&#x27;: {&#x27;requestPath&#x27;: {&#x27;classifier&#x27;: &#x27;registry.connect.redhat.com/seldonio/sklearnserver@sha256:88d126455b150291cbb3772f67b4f35a88bb54b15ff7c879022f77fb051615ad&#x27;}}}</span></code></pre></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><h1>Conclusion</h1>\n<p>In this notebook, we saw how to create and save an unsupervised model for clustering build logs. We successfully deployed and tested the model using s3 for storage and a seldon service on Openshift. </p></div></div></div></div>","fields":{"srcLink":"https://github.com/aicoe-aiops/ocp-ci-analysis/blob/master/notebooks/data-sources/gcsweb-ci/build-logs/model_seldon.ipynb"}}},"pageContext":{"id":"e3365e98-c16b-598f-a395-2d71546d74f4 >>> JupyterNotebook"}},"staticQueryHashes":["1764348645","2823140819","3000541721","3606484676"]}